<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ui/forms/form.service.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-branching.html">Branching Strategy</a></li><li><a href="tutorial-contributing_guide.html">Contributing Guide</a></li><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-meta_documentation.html">Meta Documentation</a></li><li><a href="tutorial-modules.html">Modules</a></li><li><a href="tutorial-translations.html">Translations</a></li><li><a href="tutorial-user.html">User Guide</a></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_modelManager.html">modelManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_modelManager.html#~applyDefault">applyDefault</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~deleteColumns">deleteColumns</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~getSchema">getSchema</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~getSchema">getSchema</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~modifyPropNames">modifyPropNames</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~save">save</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~setDefault">setDefault</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~setModels">setModels</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~setSchema">setSchema</a></li><li data-type='method'><a href="app.common.module_modelManager.html#~updateModel">updateModel</a></li></ul></li><li><a href="app.common.module_stateManager.html">stateManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_stateManager.html#~addLink">addLink</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~addSpecific">addSpecific</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~buildStateTree">buildStateTree</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~existInStateModel">existInStateModel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~findTitle">findTitle</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getState">getState</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getValidityValue">getValidityValue</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~goNoGoPreview">goNoGoPreview</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~isValid">isValid</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~listAdvanceHidden">listAdvanceHidden</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~reduceKey">reduceKey</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~reduceMapArray">reduceMapArray</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~removeNonExistent">removeNonExistent</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~searchUndefined">searchUndefined</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setAdvance">setAdvance</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setCustomTitles">setCustomTitles</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setItemId">setItemId</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setMapItemsState">setMapItemsState</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setMasterValidity">setMasterValidity</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setStateValueDown">setStateValueDown</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setStateValueUp">setStateValueUp</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setTitle">setTitle</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~uniqId">uniqId</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~updateSummaryForm">updateSummaryForm</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~updateSummaryFormMap">updateSummaryFormMap</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~updateValidity">updateValidity</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~validateModel">validateModel</a></li></ul></li><li><a href="app.geo.module_gapiService.html">gapiService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_gapiService.html#~init">init</a></li></ul></li><li><a href="app.geo.module_layerService.html">layerService</a></li><li><a href="app.geo.module_projectionService.html">projectionService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_projectionService.html#~projectExtent">projectExtent</a></li></ul></li><li><a href="app.layout.module_avAccordion.html">avAccordion</a><ul class='methods'><li data-type='method'><a href="app.layout.module_avAccordion.html#~addButton">addButton</a></li><li data-type='method'><a href="app.layout.module_avAccordion.html#~addIcon">addIcon</a></li><li data-type='method'><a href="app.layout.module_avAccordion.html#~avAccordion">avAccordion</a></li><li data-type='method'><a href="app.layout.module_avAccordion.html#~setAccordion">setAccordion</a></li></ul></li><li><a href="app.layout.module_avDragHandle.html">avDragHandle</a><ul class='methods'><li data-type='method'><a href="app.layout.module_avDragHandle.html#~avDragHandle">avDragHandle</a></li></ul></li><li><a href="app.layout.module_avFrame.html">avFrame</a><ul class='methods'><li data-type='method'><a href="app.layout.module_avFrame.html#~avFrame">avFrame</a></li></ul></li><li><a href="app.layout.module_avShell.html">avShell</a><ul class='methods'><li data-type='method'><a href="app.layout.module_avShell.html#~updateClass">updateClass</a></li></ul></li><li><a href="app.module_core.html">core</a><ul class='methods'><li data-type='method'><a href="app.module_core.html#~addButton">addButton</a></li><li data-type='method'><a href="app.module_core.html#~addTranslations">addTranslations</a></li><li data-type='method'><a href="app.module_core.html#~clickSubTab">clickSubTab</a></li><li data-type='method'><a href="app.module_core.html#~clickTab">clickTab</a></li><li data-type='method'><a href="app.module_core.html#~compile">compile</a></li><li data-type='method'><a href="app.module_core.html#~getLang">getLang</a></li><li data-type='method'><a href="app.module_core.html#~getLangs">getLangs</a></li><li data-type='method'><a href="app.module_core.html#~getNested">getNested</a></li><li data-type='method'><a href="app.module_core.html#~getUUID">getUUID</a></li><li data-type='method'><a href="app.module_core.html#~isArray">isArray</a></li><li data-type='method'><a href="app.module_core.html#~isObject">isObject</a></li><li data-type='method'><a href="app.module_core.html#~parseJSON">parseJSON</a></li><li data-type='method'><a href="app.module_core.html#~post">post</a></li><li data-type='method'><a href="app.module_core.html#~registerDebounce">registerDebounce</a></li><li data-type='method'><a href="app.module_core.html#~scrollToElement">scrollToElement</a></li><li data-type='method'><a href="app.module_core.html#~setExtensionDialog">setExtensionDialog</a></li><li data-type='method'><a href="app.module_core.html#~setLang">setLang</a></li><li data-type='method'><a href="app.module_core.html#~setLangs">setLangs</a></li><li data-type='method'><a href="app.module_core.html#~setUniq">setUniq</a></li><li data-type='method'><a href="app.module_core.html#~whatsThat">whatsThat</a></li></ul></li><li><a href="app.module_ui.html">ui</a><ul class='methods'><li data-type='method'><a href="app.module_ui.html#~copyValueToFormIndex">copyValueToFormIndex</a></li><li data-type='method'><a href="app.module_ui.html#~copyValueToModelIndex">copyValueToModelIndex</a></li><li data-type='method'><a href="app.module_ui.html#~findValues">findValues</a></li><li data-type='method'><a href="app.module_ui.html#~initValueToFormIndex">initValueToFormIndex</a></li><li data-type='method'><a href="app.module_ui.html#~resestShowAdvance">resestShowAdvance</a></li><li data-type='method'><a href="app.module_ui.html#~setErrorMessage">setErrorMessage</a></li><li data-type='method'><a href="app.module_ui.html#~setExtent">setExtent</a></li><li data-type='method'><a href="app.module_ui.html#~showAdvance">showAdvance</a></li><li data-type='method'><a href="app.module_ui.html#~toggleAll">toggleAll</a></li><li data-type='method'><a href="app.module_ui.html#~toggleSection">toggleSection</a></li><li data-type='method'><a href="app.module_ui.html#~updateLinkValues">updateLinkValues</a></li></ul></li><li><a href="app.ui.module_avBindValue.html">avBindValue</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avBindValue.html#~avBindValue">avBindValue</a></li></ul></li><li><a href="app.ui.module_avCompileHtml.html">avCompileHtml</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avCompileHtml.html#~avCompileHtml">avCompileHtml</a></li></ul></li><li><a href="app.ui.module_avContentPanel.html">avContentPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avContentPanel.html#~addHeaderControl">addHeaderControl</a></li><li data-type='method'><a href="app.ui.module_avContentPanel.html#~initFooter">initFooter</a></li><li data-type='method'><a href="app.ui.module_avContentPanel.html#~link">link</a></li></ul></li><li><a href="app.ui.module_avHeader.html">avHeader</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avHeader.html#~avHeader">avHeader</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~create">create</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~filesSubmitted">filesSubmitted</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~getTemplates">getTemplates</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~save">save</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~save">save</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~setLanguage">setLanguage</a></li><li data-type='method'><a href="app.ui.module_avHeader.html#~setTemplate">setTemplate</a></li></ul></li><li><a href="app.ui.module_avLanguage.html">avLanguage</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avLanguage.html#~avLanguage">avLanguage</a></li></ul></li><li><a href="app.ui.module_avMap.html">avMap</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avMap.html#~avMap">avMap</a></li><li data-type='method'><a href="app.ui.module_avMap.html#~setCollapsibleHeader">setCollapsibleHeader</a></li><li data-type='method'><a href="app.ui.module_avMap.html#~setCollapsibleHeaderEntry">setCollapsibleHeaderEntry</a></li></ul></li><li><a href="app.ui.module_avServices.html">avServices</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avServices.html#~avServices">avServices</a></li></ul></li><li><a href="app.ui.module_avSummary.html">avSummary</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avSummary.html#~avSummary">avSummary</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~expandSummary">expandSummary</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~initState">initState</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~openPreview">openPreview</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~previewReady">previewReady</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~setSubTab">setSubTab</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~setSubTabID">setSubTabID</a></li><li data-type='method'><a href="app.ui.module_avSummary.html#~walkTree">walkTree</a></li></ul></li><li><a href="app.ui.module_avTab.html">avTab</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avTab.html#~avTab">avTab</a></li><li data-type='method'><a href="app.ui.module_avTab.html#~mapTabs">mapTabs</a></li></ul></li><li><a href="app.ui.module_avTest.html">avTest</a></li><li><a href="app.ui.module_avTree.html">avTree</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avTree.html#~avTree">avTree</a></li></ul></li><li><a href="app.ui.module_avUi.html">avUi</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avUi.html#~avUi">avUi</a></li><li data-type='method'><a href="app.ui.module_avUi.html#~getAboutChoice">getAboutChoice</a></li></ul></li><li><a href="app.ui.module_avVersion.html">avVersion</a><ul class='methods'><li data-type='method'><a href="app.ui.module_avVersion.html#~avVersion">avVersion</a></li></ul></li><li><a href="app.ui.module_dynamicSelect.html">dynamicSelect</a><ul class='methods'><li data-type='method'><a href="app.ui.module_dynamicSelect.html#~dynamicSelect">dynamicSelect</a></li></ul></li><li><a href="material.components.button.module_MdButtonDirectiveDecorator.html">MdButtonDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.button.module_MdButtonDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li><li><a href="material.components.tooltip.module_mdTooltipDirective.html">mdTooltipDirective</a><ul class='methods'><li data-type='method'><a href="material.components.tooltip.module_mdTooltipDirective.html#~decorateCompile">decorateCompile</a></li><li data-type='method'><a href="material.components.tooltip.module_mdTooltipDirective.html#~isTouch">isTouch</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.addon.html">addon</a></li><li><a href="app.core.html">core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li></ul></li><li><a href="app.geo.html">geo</a></li><li><a href="app.layout.html">layout</a></li><li><a href="app.ui.html">ui</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$on">$on</a></li><li><a href="global.html#applyDefault">applyDefault</a></li><li><a href="global.html#AV">AV</a></li><li><a href="global.html#avDefaults">avDefaults</a></li><li><a href="global.html#compile">compile</a></li><li><a href="global.html#configureParser">configureParser</a></li><li><a href="global.html#initLanguages">initLanguages</a></li><li><a href="global.html#initShortcut">initShortcut</a></li><li><a href="global.html#loadExtensions">loadExtensions</a></li><li><a href="global.html#uploadDefault">uploadDefault</a></li><li><a href="global.html#uploadSchema">uploadSchema</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">ui/forms/form.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const templateUrl = require('./map/extent/extent-dialog.html');
/**
 *
 * @name formService
 * @module app.ui
 *
 * @description common JavaScript methods for forms
 *
 */
angular
    .module('app.ui')
    .factory('formService', formService);

function formService($timeout, $rootScope, events, $mdDialog, $translate, commonService, constants, projectionService) {

    const service = {
        showAdvance,
        advanceModel: false,
        toggleSection,
        toggleAll,
        setExtent,
        setErrorMessage,
        copyValueToFormIndex,
        initValueToFormIndex,
        copyValueToModelIndex,
        updateLinkValues
    };

    // if show advance is true we need to toggle the hidden because the form has been reset
    events.$on(events.avSchemaUpdate, () => { resestShowAdvance(); });
    events.$on(events.avLoadModel, () => { resestShowAdvance(); });
    events.$on(events.avSwitchLanguage, () => { resestShowAdvance(); });

    return service;

    /***/

    /**
     * Reset show advance fields if needed when there is a new model or language switch
     * @function resestShowAdvance
     */
    function resestShowAdvance() {
        if (service.advanceModel) { $timeout(() => showAdvance(), constants.delayAccordion); }
    }

    /**
     * Show advance fields
     * @function showAdvance
     */
    function showAdvance() {
        // manage the show advance configuration (add 'htmlClass': 'av-form-advance hidden' to fields who need advance config)
        const elems = document.getElementsByClassName('av-form-advance');

        for (let elem of elems) {
            elem.classList.toggle('hidden');
        }
    }

    /**
     * Toggle one section of accordion panel
     * @function toggleSection
     * @param  {Object} event  event who trigger the action
     */
    function toggleSection(event) {
        const targetParent = event.currentTarget.parentElement;
        $(targetParent.getElementsByClassName('av-accordion-content')).slideToggle(400, 'swing');

        const icons = targetParent.getElementsByTagName('md-icon');
        for (let elem of icons) {
            elem.classList.toggle('hidden');
        }
    }

    /**
     * Toggle all sections of accordion panel (array of accordion items)
     * @function toggleAll
     * @param  {Object} event  event who trigger the action
     * @param  {Bolean} collapse  true if collapse false if expand
     */
    function toggleAll(event, collapse) {
        const targetParent = event.currentTarget.parentElement;
        const iconsExp = targetParent.getElementsByClassName('av-accordion-expand');
        const iconsCol = targetParent.getElementsByClassName('av-accordion-collapse');

        if (collapse) {
            $(targetParent.getElementsByClassName('av-accordion-content')).slideUp(400, 'swing');
            for (let elem of iconsExp) {
                elem.classList.remove('hidden');
            }
            for (let elem of iconsCol) {
                elem.classList.add('hidden');
            }
        } else {
            $(targetParent.getElementsByClassName('av-accordion-content')).slideDown(400, 'swing');
            for (let elem of iconsExp) {
                elem.classList.add('hidden');
            }
            for (let elem of iconsCol) {
                elem.classList.remove('hidden');
            }
        }
    }

    /**
     * Set extent from the viewer itself open in an iFrame
     * @function setExtent
     * @param  {String} type  type of extent ('default', 'full' or 'maximum')
     * @param  {Array} extentSets  array of extent set to set the extent for
     */
    function setExtent(type, extentSets) {
        $mdDialog.show({
            controller: extentController,
            controllerAs: 'self',
            templateUrl: templateUrl,
            parent: $('.fgpa'),
            disableParentScroll: false,
            clickOutsideToClose: true,
            fullscreen: false,
            onRemoving: () => {
                // get the extent from local storage
                const extent = JSON.parse(localStorage.getItem('mapextent'));
                localStorage.removeItem('mapextent');

                // for each extent set, project the extent in the proper projection then set values
                extentSets.forEach(extentSet => {
                    // project extent
                    const ext = projectionService.projectExtent(extent, extentSet.spatialReference);

                    // itnitialze the value because it will not work if it doesn't exist then apply values
                    extentSet[type] = {};
                    extentSet[type].xmin = ext.x0;
                    extentSet[type].ymin = ext.y0;
                    extentSet[type].xmax = ext.x1;
                    extentSet[type].ymax = ext.y1;
                })
            }
        });

        function extentController($mdDialog) {
            'ngInject';
            const self = this;

            self.close = $mdDialog.hide;
        }
    }

    /**
     * Set custom validation error message
     * inside translation.csv the variable to replace needs to be there inside {}
     * @function setErrorMessage
     * @param  {Object} form  form object to get value from
     * @param  {String} message  message to get from translation.csv
     * @param  {Array} variables  variables to replace
     * @return {String} mess the updated message
     */
    function setErrorMessage(form, message, variables) {
        let mess = $translate.instant(message);

        for (let variable of variables) {
            // get the replacing value from form object
            let replace = form;
            variable.split('.').map(item => { replace = replace[item] });

            // replace value in the message
            mess = mess.replace(`{${variable}}`, replace);
        }

        return mess;
    }

    /**
     * Assign the value to the form element. Use active element to get target tp update value for
     *
     * Need to have on the item:
     *  'targetLink': 'legend.0', the target tag inside inside target parent and the array index for children
     *  'targetParent': 'av-accordion-toggle', the parent element target class
     *  'default': a default value for the tag when model value is empty
     * @function copyValueToFormIndex
     * @private
     * @param  {Object} model  value to set
     * @param  {String} item item from the form
     */
    function copyValueToFormIndex(model, item) {
        // get targetLink info
        const itemLink = item.targetLink.split('.');

        // get active element to retrieve targetParent (loop throught parent element to find the target)
        let flag = false;
        let element = document.activeElement;

        while(!flag) {
            element = element.parentElement;
            flag = element.classList.contains(item.targetParent);
        }

        // update form html element
        const modelValue = (model !== '') ? model : item.default;
        element.getElementsByTagName(itemLink[0])[itemLink[1]].innerHTML = modelValue;
    }

    /**
     * Copy a value from the model to a form element who contain index when form loads
     * @function initValueToFormIndex
     * @param  {Array} modelArray  model array of values to apply
     * @param  {Array} classEl array of classes/index on the form element to retrieve it
     * @param  {String} field field on the model to get the value to apply
     * @param  {String} targetLink target element info to apply value to
     */
    function initValueToFormIndex(modelArray, classEl, field, targetLink) {
        // get targetLink info
        const itemLink = targetLink.split('.');

        // loop throught classEl elements to get proper html item
        let elements = document;
        for (let elemClass of classEl) {
            // get the element from the class (all li elements (the html array))
            elements = $(elements.getElementsByClassName(elemClass.cls)).children('ol').children('li');

            // if needed, get the array index to set as the right element
            elements = (elemClass.ind === -1) ? elements : elements[elemClass.ind];
        }

        // loop throught the model and assign value
        for (let [index, model] of modelArray.entries()) {
            elements[index].getElementsByTagName(itemLink[0])[itemLink[1]].innerHTML = model[field];

            // FIXME: because we can't remove fields from array (ASF problem), we need to remove the hidden class
            // if there is a field when we load a new model
            if (typeof model.table !== 'undefined' &amp;&amp; model.table.columns.length > 0) {
                if (typeof model.table.columns[0].title === 'string') {
                    elements[index].getElementsByClassName('av-columns')[0].classList.remove('hidden');
                }
            }
        }
    }

    /**
     * Copy a value from the model to a model element who contain index
     *
     * Need to have on the item:
     *  'targetElement': ['layers', 'layerType'], array of keys to to get the element to update
     *  'targetParent': 'av-accordion-content', the parent element target class to find index of
     * @function copyValueToModelIndex
     * @param  {Object} modelValue  model value
     * @param  {String} item form item
     * @param  {String} model model to update
     */
    function copyValueToModelIndex(modelValue, item, model) {
        // get active element to retrieve targetParent (loop throught parent element to find the target)
        let flag = false;
        let element = document.activeElement;

        while (!flag) {
            element = element.parentElement;
            flag = element.classList.contains(item.targetParent);
        }

        // get active index
        const index = element.getAttribute('sf-index');

        // find the key to update, if it is an array, use the index found before
        let update = model;
        for (let key of item.targetElement) {
            update = commonService.isArray(update[key]) ? update[key][index] :
                (typeof update[key] === 'object') ? update[key] : update[key] = modelValue;
        }
    }

    /**
    * Update scope element use inside a dynamic-select drop dowm. The value is use to link field together
    * e.g. in TitleSchema, we have extentSetId who is the value of one extent set id. This function Will
    * populate the scope element with all extent set id so user don't have to type them in
    *
    * Need an item to have the selection dropdown:
    * { 'key': 'tileSchemas[].extentSetId', 'type': 'dynamic-select', 'optionData': 'extentId', 'model': 'extentSetId' }
    * 'type' must be type-select, it will trigger the add on.
    * 'optionData' is the variable name to create on scope object
    * 'model' must be the last key in the path for this element (it is use inside dynamicSelect.module for ngModel)
    *
    * Need items with an values to updateModel
    * { 'key': 'extentSets[].id', 'onChange': () => { debounceService.registerDebounce(self.formService.updateLinkValues(scope, ['extentSets', 'id'], 'extentId'), constants.debInput, false); } },
    * 'onChange' function to use the self.formService.updateLinkValues where
    * scope is the form scope
    * Array of keys made from key element
    * The same variable name created for the first element
    *
    * For a sample with a broadcast event, look at avLayersIdupdateEvents
    *
    * Known issue: onChange is not fired on the last item delete inside an array. Will need to find a workaround if need be
    * @function updateLinkValues
    * @param  {Object} scope  form scope
    * @param  {Array} keys the path to the key to get value from
    * @param  {String} link the value to update (need to be the same on optionData as the the field who receive the link)
    * @param  {String} broadcast optional - the event to broadcast. This will be use to update link in another scope model
    */
    function updateLinkValues(scope, keys, link, broadcast = false) {
        // find values then remove undefined
        scope[link] = findValues(scope.model, keys, 0, []).filter(val => (typeof val !== 'undefined'));

        // if array of options is empty, add a message. This way validation will apply
        // when options are empty, the last item removed doesn't trigger validation
        if (scope[link].length === 0) {
            scope[link].push($translate.instant('options.dynamicselect'));
        }

        if (broadcast !== false) {
            $rootScope.$broadcast(events[broadcast], scope[link]);
        }
    }

    /**
    * Find values from the model element
    * @function findValues
    * @private
    * @param  {Object} model  model to find from
    * @param  {Array} keys the path to key
    * @param  {Integer} index index in the array
    * @param  {Array} returnValues array of values
    * @return {Array} returnValues array of values
    */
    function findValues(model, keys, index, returnValues) {
        // get the key to check for
        const key = keys.shift();

        // deal differently if it is an array or not
        if (commonService.isArray(model[key])) {
            for (let i = 0; i &lt; model[key].length; i++) {
                // loop the array. Make a copy of keys so we don't empty it on first element
                findValues(model[key][i], keys.slice(0), i, returnValues);
            }
        } else {
            // if there is key in the array of keys, walk a level deeper
            let item = keys.length > 0 ? findValues(model[key], keys, index, returnValues) : model[key];

            // if the item equal the value to search, add the index to the return value
            returnValues.push(item);
        }

        return returnValues;
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Feb 15 2018 14:54:04 GMT-0500 (EST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
